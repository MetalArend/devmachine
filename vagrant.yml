vagrant:
    api_version: "2"
    host: detect

vm:
    # http://www.vagrantbox.es/
    box: "ubuntu64" # TODO trusty64
    box_url: "https://cloud-images.ubuntu.com/vagrant/precise/current/precise-server-cloudimg-amd64-vagrant-disk1.box"
    hostname: null
    usable_port_range: 2200..2500
    network:
        private_network: 192.168.100.100 # TODO use this ip address in php code dynamically
        forwarded_ports:
            # ssh is set by default - overwriting this can lead to unexpected behavior
            #ssh:
            #    host: 2222
            #    guest: 22
            http_8080:
                host: 8080
                guest: 80
            http_8000:
                host: 8000
                guest: 8000
            ssh_8433:
                host: 8433
                guest: 433
    provider:
        virtualbox:
            memory: 2048
            cpus: 2 # 1
            modifyvm:
                name: devmachine
                # natdnsproxy1: on
                natdnshostresolver1: on
                # rtcuseutc: on # bugfix ssh connection - https://github.com/mitchellh/vagrant/issues/391
                memory: '2048'
            gui: false
            setextradata:
                VBoxInternal2/SharedFoldersEnableSymlinksCreate/v-root: 1 # enable symlinks for windows
            check_guest_additions: false
            functional_vboxsf: false
    provision:
        cleanup:
            type: shell
            path: ./shell/cleanup-docker.sh
            dos2unix: ['/env/shell/* -name \"cleanup-docker.sh\"']
            keep_color: true
        project_playbooks:
            type: shell
            inline: |
                export PYTHONUNBUFFERED=1
                export ANSIBLE_FORCE_COLOR=1
                find "/env/workspace" -iname "playbook.yml" -not -path "*/vendor/*" -exec echo -e "\e[93mRun ansible playbook \"{}\"\e[0m" \; -exec ansible-playbook -i /etc/ansible/local-hosts "{}" --connection=local \;
            keep_color: true
        project_scripts:
            type: shell
            inline: |
                find "/env/workspace" -iname "provision-docker-compose.sh" -exec echo -e "\e[93mRun shell script \"{}\"\e[0m" \; -exec bash "{}" \;
            dos2unix: [/env/shell/* -name "*.sh", /env/workspace/* -not -path */vendor/* -name "provision-docker-compose.sh"]
            keep_color: true
    synced_folder:
        # TODO http://jeremykendall.net/2013/08/09/vagrant-synced-folders-permissions/
        # TODO http://www.sebastien-han.fr/blog/2012/12/18/noac-performance-impact-on-web-applications/
        # Having the /env folder with the same group setting as that
        # of the apache2 process' group ensures that Apache2 can access and modify
        # files under it, without explicitly chmod-ing them to 777
        # This only works for the default provider
        # - With nfs we cannot set the group for the directory,
        # and php5-fpm will probably not be able to read the files.
        # - With rsync two-way sync is not possible
        environment:
            source: ./
            target: /env
#            owner: vagrant
#            group: www-data
            type: nfs

ssh:
    host: null
    port: null
    private_key_path: null
    username: vagrant # TODO https://github.com/Varying-Vagrant-Vagrants/VVV/issues/375
    guest_port: null
    keep_alive: true
    forward_agent: false # TODO true http://wildlyinaccurate.com/using-ssh-agent-forwarding-with-vagrant/
    forward_x11: false
    shell: "bash -c 'BASH_ENV=/etc/profile exec bash'" # default: "bash -l", but this resolves the stdin error

devmachine:
    timezone: Europe/Brussels
    locale: en_US.UTF-8
    start: /env

docker:
    version: 1.7.1
    group_members: vagrant

docker_compose:
    version: 1.3.3

ansible:
    version: 1.9.2
    playbook: /env/playbook.yml
